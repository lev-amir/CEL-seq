---
title: "Descriptive statistics and correlations of T-box transcription factors motifs"
author: "Amir Levine"
date: "2018-10-28"
output: md_document
---

Load packages and datasets.
PWMEnrich object of Tbox transcrption factors motifs enrichement in the promoters of anc-1 RNAi regulateed genes.
```{r}
if (!require(tidyverse)) {install.packages("tidyverse"); library(tidyverse)}
if (!require(Hmisc)) {install.packages("Hmisc"); library(Hmisc)}
if (!require(corrplot)) {install.packages("corrplot"); library(corrplot)}

load("data/geneExpression.rdata")
load("experiments/2018-07-11-tbx-motifs/data/Tbox-anc1-reg-enriched.Rdata")
```

## Create p-values matrix
Obtain the *p*-values of motifs per sequence.
* Rows correspond to the different input sequences and the columns correspond to motifs.
* `sequence.nobg` contains the raw affinity scores.
* `sequence.bg` contains the corresponding P-values.
```{r}
pvals.dn.mat <- res.dn$sequence.bg
```

Rename the column names to be the T-box protein names.
```{r}
colnames(pvals.dn.mat) <- c("TBX-33","TBX-38","TBX-39","TBX-40","TBX-43")
```

Change *p*-value to boolean. TRUE is statistically significant (*p*-value < 0.05).
```{r}
pvals.dn.sig <- (pvals.dn.mat < 0.05)
```

## Descriptive statistics of the T-box motifs in the downregulated gene

What percentage of the downregulated genes have each T-box motif?
```{r}
round(sum(pvals.dn.sig[,1]) / nrow(pvals.dn.mat) * 100,2) # 7.46%
round(sum(pvals.dn.sig[,2]) / nrow(pvals.dn.mat) * 100,2) # 8.96%
round(sum(pvals.dn.sig[,3]) / nrow(pvals.dn.mat) * 100,2) # 7.71%
round(sum(pvals.dn.sig[,4]) / nrow(pvals.dn.mat) * 100,2) # 8.71%
round(sum(pvals.dn.sig[,5]) / nrow(pvals.dn.mat) * 100,2) # 5.47%
```

Filter-out genes w/o a motif.
```{r}
pvals.sig.filter <- pvals.dn.sig[rowSums(pvals.dn.sig) > 0,]
```

How many downregulated genes have at least one T-box transcription factors binding motifs?
```{r}
dim(pvals.sig.filter)[1] # 102
```

What fraction of the downregulated genes have at least one T-box motif?
```{r}
round(dim(pvals.sig.filter)[1] / dim(pvals.dn.mat)[1] * 100,2) # 25.37%
```

What is the distribution of the T-box motifs in the downregulated genes?
```{r}
tibble(gnames = rownames(pvals.sig.filter),
       n_motifs = rowSums(pvals.sig.filter)) %>%
  group_by(n_motifs) %>%
  summarise(n_genes = n()) %>%
  ggplot(aes(x = n_motifs, y = n_genes)) + geom_col(position = "identity")
```

## Correlations of *p*-values

Is there a correlation in motif presence between any two motifs?
```{r}
pvals.cor <- Hmisc::rcorr(pvals.dn.mat)
# Removing all the genes that don't possess a T-box transcription factors motif
pvals.mat.filt <- pvals.dn.mat[rowSums(pvals.dn.sig) > 0,]
pvals.cor.filt <- Hmisc::rcorr(pvals.mat.filt)
```
TBX-38 and TBX-43 correlate
TBX-39 and TBX-40 correlate
Both as expected from their motifs.
TBX-33 weakly correlates with all the other four transcription factors.

Plot correlations of p-values matrix.
```{r}
library(RColorBrewer)

# All down-regulated genes

svg(filename = "experiments/2018-10-28-tbx-enrich-corr/results/tbx-motifs-cor-all.svg",
    height = 2,
    width = 2,
    pointsize = 7)
cp <- corrplot::corrplot(pvals.cor$r,
                         method = "shade",
                         type="upper",
                         addgrid.col = "black",
                         order="hclust",
                         col=brewer.pal(n=10, name="RdBu"),
                         tl.col="black", 
                         tl.srt=45,
                         cl.align.text="l",
                         p.mat = pvals.cor$P,
                         sig.level = 0.05,
                         insig = "label_sig",
                         # hide correlation coefficient on the principal diagonal
                         diag=FALSE )
dev.off()

# Down-regulated genes with at least one T-box transcription factors motif

svg(filename = "experiments/2018-10-28-tbx-enrich-corr/results/tbx-motifs-cor-w-motif.svg",
    height = 2,
    width = 2,
    pointsize = 7)
cp <- corrplot::corrplot(pvals.cor.filt$r,
                         method = "shade",
                         type="upper",
                         addgrid.col = "black",
                         order="hclust",
                         col=brewer.pal(n=10, name="RdBu"),
                         tl.col="black", 
                         tl.srt=45,
                         cl.align.text="l",
                         p.mat = pvals.cor.filt$P,
                         sig.level = 0.05,
                         insig = "label_sig",
                         # hide correlation coefficient on the principal diagonal
                         diag=FALSE )
dev.off()
```

